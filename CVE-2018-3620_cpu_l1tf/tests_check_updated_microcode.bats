#!/usr/bin/env bats

. test_harness

@test "check_updated_microcode -- flag all cpus" {
    export MOCK_CPU_INFO_PATH=file_mocks/cpuinfo/updated_microcode_intel
    run check_updated_microcode
    (( status ==  1))
}


@test "check_updated_microcode -- flag one cpu" {
    export MOCK_CPU_INFO_PATH=file_mocks/cpuinfo/updated_microcode_partial
    run check_updated_microcode
    echo $output
    [[ $output == "" ]]
    (( status ==  0))
}


@test "check_updated_microcode -- none cpu" {
    export MOCK_CPU_INFO_PATH=file_mocks/cpuinfo/affected_intel
    run check_updated_microcode
    (( status ==  0))
}


@test "check_updated_microcode -- non-intel cpus" {
    export MOCK_CPU_INFO_PATH=file_mocks/cpuinfo/not_aff_amd
    run check_updated_microcode
    (( status ==  0))
    export MOCK_CPU_INFO_PATH=file_mocks/cpuinfo/not_aff_arm
    run check_updated_microcode
    (( status ==  0))
    export MOCK_CPU_INFO_PATH=file_mocks/cpuinfo/not_aff_power8
    run check_updated_microcode
    (( status ==  0))
}
