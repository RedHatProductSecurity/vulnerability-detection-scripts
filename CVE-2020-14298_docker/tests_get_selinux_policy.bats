#!/usr/bin/env bats

. test_harness


@test "get_selinux_policy -- not available" {
    command() { 
        return 1
    }  

    run get_selinux_policy
    (( status == 1 ))
}


@test "get_selinux_policy -- targeted RHEL 7" {
    command() { 
        return 0
    }
    sestatus() {
        cat << EOF
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Max kernel policy version:      31
EOF
    }

    run get_selinux_policy
    (( status == 0 ))
    [[ "$output" == "targeted" ]]   
}


@test "get_selinux_policy -- minimum RHEL 7" {
    command() { 
        return 0
    }
    sestatus() {
        cat << EOF
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             minimum
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Max kernel policy version:      31
EOF
    }

    run get_selinux_policy
    (( status == 0 ))
    [[ "$output" == "minimum" ]]   
}


@test "get_selinux_policy -- targeted RHEL 5" {
    command() { 
        return 0
    }
    sestatus() {
        cat << EOF
SELinux status:                 enabled
SELinuxfs mount:                /selinux
Current mode:                   enforcing
Mode from config file:          error (Success)
Policy version:                 21
Policy from config file:        targeted
EOF
    }

    run get_selinux_policy
    (( status == 0 ))
    [[ "$output" == "targeted" ]]   
}


@test "get_selinux_policy -- minimum RHEL 5" {
    command() { 
        return 0
    }
    sestatus() {
        cat << EOF
SELinux status:                 enabled
SELinuxfs mount:                /selinux
Current mode:                   enforcing
Mode from config file:          error (Success)
Policy version:                 21
Policy from config file:        minimum
EOF
    }

    run get_selinux_policy
    (( status == 0 ))
    [[ "$output" == "minimum" ]]   
}
