#!/usr/bin/env bats

. test_harness


@test "basic_reqs -- Disclaimer" {
    # run basic_reqs TEST
    #[[ "$output" == *"is primarily designed to detect CVE-2021-44228 on supported"* ]]
    :
}

@test "basic_reqs -- no command available" {
    command() {
        return 1
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'readlink' command is required"* ]]
}

@test "basic_reqs -- file not available" {
    command() {
        if [[ "$2" == "file" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'file' command is required"* ]]
}

@test "basic_reqs -- unzip not available" {
    command() {
        if [[ "$2" == "unzip" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'unzip' command is required"* ]]
    [[ "$output" == *"Please run 'yum install unzip' before running this script."* ]]
}

@test "basic_reqs -- stat not available" {
    command() {
        if [[ "$2" == "stat" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'stat' command is required"* ]]
}

@test "basic_reqs -- sha256sum not available" {
    command() {
        if [[ "$2" == "sha256sum" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'sha256sum' command is required"* ]]
}

@test "basic_reqs -- basename not available" {
    command() {
        if [[ "$2" == "basename" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'basename' command is required"* ]]
}

@test "basic_reqs -- cat not available" {
    command() {
        if [[ "$2" == "cat" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'cat' command is required"* ]]
}

@test "basic_reqs -- grep not available" {
    command() {
        if [[ "$2" == "grep" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'grep' command is required"* ]]
}

@test "basic_reqs -- uname not available" {
    command() {
        if [[ "$2" == "uname" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'uname' command is required"* ]]
}

@test "basic_reqs -- pwd not available" {
    command() {
        if [[ "$2" == "pwd" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'pwd' command is required"* ]]
}

@test "basic_reqs -- /bin/rm not available" {
    command() {
        if [[ "$2" == "/bin/rm" ]] ; then
            return 1
        fi
        return 0
    }

    set_default_values
    run basic_reqs xyz
    (( status == 1 ))
    [[ "$output" == *"'/bin/rm' command is required"* ]]
}
