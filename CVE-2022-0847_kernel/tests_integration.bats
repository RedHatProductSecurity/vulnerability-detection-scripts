#!/usr/bin/env bats

export SCRIPT_NAME=$( grep -E '^\. .*\.sh$' test_harness | sed -r 's/^\. (.*)$/\1/g' )

@test "Integration -- Fedora" {
    uname() {
        echo "$FEDORA"
    }
    export -f uname

    run ./"${SCRIPT_NAME}"
    (( status == 1 ))
}


@test "Integration -- RHEL7" {
    uname() {
        echo "3.10.0-520.10.2.el7.x86_64"
    }
    export -f uname

    run ./"${SCRIPT_NAME}"
    (( status == 0 ))
}

@test "Integration -- RHEL8 vulnerable" {
    uname() {
        echo "kernel-4.18.0-147.el8.x86_64"
    }
    export -f uname

    run ./"${SCRIPT_NAME}"
    (( status == 2 ))
}


@test "Integration -- RHEL8 potentially fixed" {
    uname() {
        echo "kernel-4.19.0-147.el8.x86_64"
    }
    export -f uname

    run ./"${SCRIPT_NAME}"
    (( status == 0 ))
}
