#!/usr/bin/env bats

. test_harness


VULNERABLE_VERSIONS=(
    '2.6.18-8.1.1.el5'
    '2.6.18-8.1.3.el5'
    '2.6.32-71.7.1.el6'
    '2.6.32-71.14.1.el6'
    '3.10.0-123.el7'
    '3.10.0-123.1.2.el7'
)


@test "check_kernel -- RHEL5 vulnerable" {
    run check_kernel "2.6.18-8.1.3.el5.x86_64" "${VULNERABLE_VERSIONS[@]}"
    [[ "$output" == "2.6.18-8.1.3.el5.x86_64" ]]
}


@test "check_kernel -- RHEL5 safe" {
    run check_kernel "2.6.18-8.1.10.el5.x86_64" "${VULNERABLE_VERSIONS[@]}"
    [[ ! "$output" ]]
}


@test "check_kernel -- RHEL6 vulnerable" {
    run check_kernel "2.6.32-71.14.1.el6.x86_64" "${VULNERABLE_VERSIONS[@]}"
    [[ "$output" == "2.6.32-71.14.1.el6.x86_64" ]]
}


@test "check_kernel -- RHEL6 safe" {
    run check_kernel "2.6.32-71.40.1.el6.x86_64" "${VULNERABLE_VERSIONS[@]}"
    [[ ! "$output" ]]
}


@test "check_kernel -- RHEL7 vulnerable 1" {
    run check_kernel "3.10.0-123.el7.x86_64" "${VULNERABLE_VERSIONS[@]}"
    [[ "$output" == "3.10.0-123.el7.x86_64" ]]
}


@test "check_kernel -- RHEL7 vulnerable 2" {
    run check_kernel "3.10.0-123.1.2.el7.x86_64" "${VULNERABLE_VERSIONS[@]}"
    [[ "$output" == "3.10.0-123.1.2.el7.x86_64" ]]
}


@test "check_kernel -- RHEL7 safe" {
    run check_kernel "3.10.0-327.18.2.el7" "${VULNERABLE_VERSIONS[@]}"
    [[ ! "$output" ]]
}
