#!/usr/bin/env bats

. test_harness

@test "gather_info_vulnerability_file -- Vulnerable" {
    export MOCK_VULNS_PATH=file_mocks/vulns/vulnerable

    gather_info_vulnerability_file; run gather_info_vulnerability_file
    (( vulnerability_file_present == 1 ))
    (( updated_kernel == 1 ))
    (( vulnerable_from_kernel == 1 ))
    (( not_affected_from_kernel == 0 ))
}

@test "gather_info_vulnerability_file -- Not affected" {
    export MOCK_VULNS_PATH=file_mocks/vulns/not_affected

    gather_info_vulnerability_file; run gather_info_vulnerability_file
    (( vulnerability_file_present == 1 ))
    (( updated_kernel == 1 ))
    (( vulnerable_from_kernel == 0 ))
    (( not_affected_from_kernel == 1 ))
}

@test "gather_info_vulnerability_file -- Mitigation" {
    export MOCK_VULNS_PATH=file_mocks/vulns/mitigation

    gather_info_vulnerability_file; run gather_info_vulnerability_file
    (( vulnerability_file_present == 1 ))
    (( updated_kernel == 1 ))
    (( vulnerable_from_kernel == 0 ))
    (( not_affected_from_kernel == 0 ))
}


@test "gather_info_vulnerability_file -- Mitigation #2" {
    export MOCK_VULNS_PATH=file_mocks/vulns/mitigation_2

    gather_info_vulnerability_file; run gather_info_vulnerability_file
    (( vulnerability_file_present == 1 ))
    (( updated_kernel == 1 ))
    (( vulnerable_from_kernel == 0 ))
    (( not_affected_from_kernel == 0 ))
}


@test "gather_info_vulnerability_file -- does not exist" {
    export MOCK_VULNS_PATH=file_mocks/vulns/foobar

    gather_info_vulnerability_file; run gather_info_vulnerability_file
    (( vulnerability_file_present == 0 ))
    (( updated_kernel == 0 ))
    (( vulnerable_from_kernel == 1 ))
    (( not_affected_from_kernel == 0 ))
}
