#!/usr/bin/env bats

. test_harness


@test "detect_cpu_arch -- uname -p asdf1 uname -m asdf2" {
    uname() {
        if [[ "$1" == "-p" ]]; then
            echo "asdf1"
        fi
        if [[ "$1" == "-m" ]]; then
            echo "asdf2"
        fi
    }
    run detect_cpu_arch
    [[ "$output" == "asdf1" ]]
    (( status == 0 ))
}


@test "detect_cpu_arch -- uname -p unknown uname -m asdf2" {
    uname() {
        if [[ "$1" == "-p" ]]; then
            echo "unknown"
        fi
        if [[ "$1" == "-m" ]]; then
            echo "asdf2"
        fi
    }
    run detect_cpu_arch
    [[ "$output" == "asdf2" ]]
    (( status == 0 ))
}


@test "detect_cpu_arch -- uname -p EMPTY uname -m asdf2" {
    uname() {
        if [[ "$1" == "-p" ]]; then
            echo ""
        fi
        if [[ "$1" == "-m" ]]; then
            echo "asdf2"
        fi
    }
    run detect_cpu_arch
    [[ "$output" == "asdf2" ]]
    (( status == 0 ))
}
