#!/usr/bin/env bats

. test_harness

@test "get_installed_package_names -- both installed" {
    rpm() {
        if [[ "$1" != "-qa" ]] ; then
            echo "bad argument 1"
            return 1
        fi
        if [[ "$2" != '--queryformat=%{NAME}\n' ]] ; then
            echo "bad argument 2"
            return 1
        fi
        if [[ "$3" != "pkga" ]] ; then
            echo "bad argument 3"
            return 1
        fi
        if [[ "$4" != "pkgb" ]] ; then
            echo "bad argument 4"
            return 1
        fi
        echo "pkga"
        echo "pkgb"
        return 0
    }
    export -f rpm

    run get_installed_package_names "pkga" "pkgb"
    (( status == 0 ))
    [[ "$output" == "pkga
pkgb" ]]
}

@test "get_installed_package_names -- only one installed" {
    rpm() {
        if [[ "$1" != "-qa" ]] ; then
            echo "bad argument 1"
            return 1
        fi
        if [[ "$2" != '--queryformat=%{NAME}\n' ]] ; then
            echo "bad argument 2"
            return 1
        fi
        if [[ "$3" != "pkga" ]] ; then
            echo "bad argument 3"
            return 1
        fi
        if [[ "$4" != "pkgb" ]] ; then
            echo "bad argument 4"
            return 1
        fi
        echo "pkgb"
        return 0
    }
    export -f rpm

    run get_installed_package_names "pkga" "pkgb"
    (( status == 0 ))
    [[ "$output" == "pkgb" ]]
}

@test "get_installed_package_names -- neither installed" {
    rpm() {
        if [[ "$1" != "-qa" ]] ; then
            echo "bad argument 1"
            return 1
        fi
        if [[ "$2" != '--queryformat=%{NAME}\n' ]] ; then
            echo "bad argument 2"
            return 1
        fi
        if [[ "$3" != "pkga" ]] ; then
            echo "bad argument 3"
            return 1
        fi
        if [[ "$4" != "pkgb" ]] ; then
            echo "bad argument 4"
            return 1
        fi
        return 0
    }
    export -f rpm

    run get_installed_package_names "pkga" "pkgb"
    (( status == 0 ))
    [[ "$output" == "" ]]
}

