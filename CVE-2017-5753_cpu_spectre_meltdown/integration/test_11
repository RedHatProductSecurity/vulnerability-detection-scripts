export DESCRIPTION="RHEL5, VMWare, unsafe modules, also no CPU capabilities"
export NEXT="Update kernel modules and update microcode or fix CPU feature propagation to VM"

export MOCK_EUID=0
export MOCK_CMDLINE_PATH=file_mocks/cmdline-rhel5-vmware
export MOCK_CPU_INFO_PATH=file_mocks/cpuinfo-many-xeons
export MOCK_LOG_DMESG_PATH=file_mocks/dmesg-not-retpoline-unsafe
export MOCK_DEBUG_X86_PATH=file_mocks/foobar
export MOCK_DEBUG_POWERPC_PATH=file_mocks/foobar
export MOCK_VULNS_PATH=file_mocks/vuln-retpoline-unsafe-modules



uname() {
    if [[ "$1" == "-m" ]]; then
        echo "x86_64"
        return 0
    fi
    cat file_mocks/uname_r-rhel5-retpoline
}
export -f uname

mount() {
    if [[ -r "$MOCK_DEBUG_X86_PATH" ]]; then
        echo "debugfs"
    else
        echo ""
    fi
}
export -f mount 

virt-what() {
    cat file_mocks/virt-what-vmware
}
export -f virt-what

lsmod() {
    echo vsock
    echo vmmemctl
    echo vmci
    echo vmxnet
    echo pvscsi
    echo vmxnet3
}
export -f lsmod

modinfo() {
    echo nope retpoline
}
export -f modinfo
