#!/usr/bin/env bats

. test_harness


@test "mitigation_check -- not applied" {
    export MOCK_SMB_CONF=file_mocks/samba_not_applied
    run mitigation_check
    (( status == 1 ))
}


@test "mitigation_check -- not applied, 0" {
    export MOCK_SMB_CONF=file_mocks/samba_not_applied_0
    run mitigation_check
    (( status == 1 ))
}


@test "mitigation_check -- not applied, 000" {
    export MOCK_SMB_CONF=file_mocks/samba_not_applied_000
    run mitigation_check
    (( status == 1 ))
}


@test "mitigation_check -- invalid 1" {
    export MOCK_SMB_CONF=file_mocks/samba_invalid_1
    run mitigation_check
    (( status == 1 ))
}


@test "mitigation_check -- invalid 2" {
    export MOCK_SMB_CONF=file_mocks/samba_invalid_2
    run mitigation_check
    (( status == 1 ))
}


@test "mitigation_check -- invalid 3" {
    export MOCK_SMB_CONF=file_mocks/samba_invalid_3
    run mitigation_check
    (( status == 1 ))
}


@test "mitigation_check -- invalid 4" {
    export MOCK_SMB_CONF=file_mocks/samba_invalid_4
    run mitigation_check
    (( status == 1 ))
}


@test "mitigation_check -- applied, 1000" {
    export MOCK_SMB_CONF=file_mocks/samba_applied_1000
    run mitigation_check
    (( status == 0 ))
}


@test "mitigation_check -- applied, 01000" {
    export MOCK_SMB_CONF=file_mocks/samba_applied_01000
    run mitigation_check
    (( status == 0 ))
}


@test "mitigation_check -- applied, 3" {
    export MOCK_SMB_CONF=file_mocks/samba_applied_3
    run mitigation_check
    (( status == 0 ))
}


@test "mitigation_check -- applied, 003" {
    export MOCK_SMB_CONF=file_mocks/samba_applied_003
    run mitigation_check
    (( status == 0 ))
}


@test "mitigation_check -- applied, 100, no spaces" {
    export MOCK_SMB_CONF=file_mocks/samba_applied_100_nospaces
    run mitigation_check
    (( status == 0 ))
}


@test "mitigation_check -- applied, but commented out" {
    export MOCK_SMB_CONF=file_mocks/samba_applied_commented
    run mitigation_check
    (( status == 1 ))
}
