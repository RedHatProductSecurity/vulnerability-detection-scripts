#!/usr/bin/env bats

. test_harness


@test "check_dmesg -- dmesg program" {
    dmesg() {
        echo "TEST MSG 1"
    }
    journalctl() {
        echo "nothing relevant"
    }
    export -f dmesg
    export -f journalctl
    export MOCK_DMESG_PATH=file_mocks/dmesg/dmesg_log_test2

    run check_dmesg "TEST MSG 1"
    (( status == 1 ))
}


@test "check_dmesg -- journalctl" {
    dmesg() {
        echo "nothing relevant"
    }
    journalctl() {
        echo "Jan 01 01:01:01 hostname kernel: TEST MSG 1"
    }
    export -f dmesg
    export -f journalctl
    export MOCK_DMESG_PATH=file_mocks/dmesg/dmesg_log_test2

    run check_dmesg "TEST MSG 1"
    (( status == 1 ))
}


@test "check_dmesg -- dmesg log" {
    dmesg() {
        echo "nothing relevant"
    }
    journalctl() {
        echo "nothing relevant"
    }
    export -f dmesg
    export -f journalctl
    export MOCK_DMESG_PATH=file_mocks/dmesg/dmesg_log_test1

    run check_dmesg "TEST MSG 1"
    (( status == 1 ))
}


@test "check_dmesg -- dmesg no match" {
    dmesg() {
        echo "nothing relevant"
    }
    journalctl() {
        echo "nothing relevant"
    }
    export -f dmesg
    export -f journalctl
    export MOCK_DMESG_PATH=file_mocks/dmesg/dmesg_log_test2

    run check_dmesg "TEST MSG 1"
    (( status == 0 ))
}

